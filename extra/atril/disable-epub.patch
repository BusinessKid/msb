commit 00b1d84fc528fe903175c82145770960dfdc715e
Author: infirit <infirit@gmail.com>
Date:   Mon Oct 27 22:03:36 2014 +0100

    Autotools: Make epub really optional

diff --git a/configure.ac b/configure.ac
index 3f0e59e..034f18d 100644
--- a/configure.ac
+++ b/configure.ac
@@ -138,13 +138,13 @@ MATEDESKTOP_REQUIRED=1.9.0
 
 case "$with_gtk" in
   2.0) GTK_API_VERSION=2.0
-	   WEBKIT_API_VERSION=1.0
+       WEBKIT_API_VERSION=1.0
        GAIL_API_VERSION=
        GTK_REQUIRED=2.24.0
        WEBKIT_REQUIRED=2.4.3
        ;;
   3.0) GTK_API_VERSION=3.0
-	   WEBKIT_API_VERSION=3.0
+       WEBKIT_API_VERSION=3.0
        GAIL_API_VERSION=-3.0
        GTK_REQUIRED=3.0.0
        WEBKIT_REQUIRED=2.4.3
@@ -171,14 +171,6 @@ AC_SEARCH_LIBS([hypot],[m])
 
 PKG_CHECK_MODULES(LIBDOCUMENT, gtk+-$GTK_API_VERSION >= $GTK_REQUIRED gio-2.0 >= $GLIB_REQUIRED)
 PKG_CHECK_MODULES(LIBVIEW, gtk+-$GTK_API_VERSION >= $GTK_REQUIRED gail$GAIL_API_VERSION >= $GTK_REQUIRED gthread-2.0 gio-2.0 >= $GLIB_REQUIRED)
-case "$with_gtk" in
-   2.0)
-    PKG_CHECK_MODULES(WEBKIT, webkit-$WEBKIT_API_VERSION >= $WEBKIT_REQUIRED)
-	;;
-    3.0)
-    PKG_CHECK_MODULES(WEBKIT, webkit2gtk-$WEBKIT_API_VERSION >= $WEBKIT_REQUIRED)
-	;;
-esac
 PKG_CHECK_MODULES(BACKEND, cairo >= $CAIRO_REQUIRED gtk+-$GTK_API_VERSION >= $GTK_REQUIRED)
 PKG_CHECK_MODULES(FRONTEND_CORE, gtk+-$GTK_API_VERSION >= $GTK_REQUIRED gthread-2.0 gio-2.0 >= $GLIB_REQUIRED)
 PKG_CHECK_MODULES(GMODULE, gmodule-2.0 >= $GLIB_REQUIRED)
@@ -710,7 +702,17 @@ AC_ARG_ENABLE(epub,
 	[enable_epub=yes])
 
 if test "x$enable_epub" = "xyes"; then
-    PKG_CHECK_MODULES(EPUB, libxml-2.0 >= $LIBXML_REQUIRED zlib,enable_epub=yes,enable_epub=no)
+    case "$with_gtk" in
+        2.0)
+        PKG_CHECK_MODULES(EPUB, webkit-$WEBKIT_API_VERSION >= $WEBKIT_REQUIRED \
+	    libxml-2.0 >= $LIBXML_REQUIRED zlib,enable_epub=yes,enable_epub=no)
+	;;
+        3.0)
+        PKG_CHECK_MODULES(EPUB, webkit2gtk-$WEBKIT_API_VERSION >= $WEBKIT_REQUIRED \
+	    libxml-2.0 >= $LIBXML_REQUIRED zlib,enable_epub=yes,enable_epub=no)
+	;;
+esac
+
 
    if test "x$enable_epub" = "xyes"; then
       AC_DEFINE([ENABLE_EPUB], [1], [Enable support for ePub documents.])
diff --git a/libview/Makefile.am b/libview/Makefile.am
index 96e80ea..f05dabc 100644
--- a/libview/Makefile.am
+++ b/libview/Makefile.am
@@ -65,7 +65,7 @@ libatrilview_la_CFLAGS = \
 	$(LIBVIEW_CFLAGS)	\
 	$(WARN_CFLAGS)		\
 	$(DISABLE_DEPRECATED)	\
-	$(WEBKIT_CFLAGS)		\
+	$(EPUB_CFLAGS)		\
 	$(AM_CFLAGS)
 
 libatrilview_la_LDFLAGS = \
@@ -77,7 +77,7 @@ libatrilview_la_LDFLAGS = \
 libatrilview_la_LIBADD = \
 	$(top_builddir)/libdocument/libatrildocument.la \
 	$(LIBVIEW_LIBS)								 \
-	$(WEBKIT_LIBS)
+	$(EPUB_LIBS)
 
 BUILT_SOURCES = 			\
 	ev-view-marshal.h		\
